(function(e){function t(t){for(var n,i,c=t[0],l=t[1],s=t[2],f=0,b=[];f<c.length;f++)i=c[f],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&b.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(b.length)b.shift()();return a.push.apply(a,s||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],n=!0,c=1;c<o.length;c++){var l=o[c];0!==r[l]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=o[0]))}return e}var n={},r={app:0},a=[];function i(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=n,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/3d/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var d=l;a.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"12d9":function(e,t,o){"use strict";o("e01d")},"56d7":function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var n=o("7a23"),r={class:"model container"};function a(e,t,o,a,i,c){var l=Object(n["k"])("Model");return Object(n["j"])(),Object(n["e"])("div",r,[Object(n["h"])(l,{url:"models/DISCOVERY_razbor_ierarhiya.FBX"})])}var i={id:"app-3d"},c=Object(n["f"])("canvas",{id:"c"},null,-1),l={id:"content"},s={class:"row"},d=Object(n["f"])("div",{class:"col-6"},[Object(n["f"])("div",{class:"room",id:"room"})],-1),f={class:"col-6"},b=Object(n["f"])("div",{class:"alert alert-primary",role:"alert"},[Object(n["f"])("ul",null,[Object(n["f"])("li",null,"Используте двойной клик для выбора объекта в комнате.")])],-1),p={action:""},u={class:"row"},h={class:"col-4"},m=["disabled"],v={class:"btn-group"},j=Object(n["f"])("i",{class:"fas fa-undo"},null,-1),O=Object(n["g"])("90° "),w=[j,O],g=Object(n["g"])("90°"),y=Object(n["f"])("i",{class:"fas fa-undo mirror"},null,-1),x=[g,y],z={class:"col-4"},M=["disabled"],A={class:"form-check form-switch"},E=Object(n["f"])("label",{class:"form-label",for:"mirrorImage"},"Зеркально",-1),P={class:"col-4"},C=["disabled"],T={class:"col-4 mt-3"},k={class:"form-check"},I=Object(n["f"])("label",{class:"form-check-label",for:"view360"}," Обзор 360 ",-1);function Z(e,t,o,r,a,j){var O=Object(n["k"])("loader");return Object(n["j"])(),Object(n["e"])(n["a"],null,[a.load3dModel?Object(n["d"])("",!0):(Object(n["j"])(),Object(n["c"])(O,{key:0,object:"#dc3545",color1:"#0d6efd",color2:"#198754",size:"5",speed:"2",bg:"#ffffff",objectbg:"#ffffff",opacity:"100",name:"circular"})),Object(n["f"])("div",i,[c,Object(n["f"])("div",l,[Object(n["f"])("div",s,[d,Object(n["f"])("div",f,[b,Object(n["f"])("form",p,[Object(n["f"])("div",u,[Object(n["f"])("div",h,[Object(n["f"])("fieldset",{disabled:0==a.showPanel},[Object(n["f"])("div",v,[Object(n["f"])("button",{onClick:t[0]||(t[0]=function(){return j.rotate90Left&&j.rotate90Left.apply(j,arguments)}),class:"btn btn-outline-primary",type:"button"},w),Object(n["f"])("button",{onClick:t[1]||(t[1]=function(){return j.rotate90Right&&j.rotate90Right.apply(j,arguments)}),class:"btn btn-outline-primary",type:"button"},x)])],8,m)]),Object(n["f"])("div",z,[Object(n["f"])("fieldset",{disabled:0==a.showPanel},[Object(n["f"])("div",A,[E,Object(n["n"])(Object(n["f"])("input",{onChange:t[2]||(t[2]=function(){return j.mirror&&j.mirror.apply(j,arguments)}),"onUpdate:modelValue":t[3]||(t[3]=function(e){return a.mirrored=e}),class:"form-check-input",type:"checkbox",id:"mirrorImage"},null,544),[[n["m"],a.mirrored]])])],8,M)]),Object(n["f"])("div",P,[Object(n["f"])("fieldset",{disabled:0==a.showPanel},[Object(n["f"])("button",{onClick:t[4]||(t[4]=function(){return j.deleteObj&&j.deleteObj.apply(j,arguments)}),type:"button",class:"btn btn-danger"},"Удалить")],8,C)]),Object(n["f"])("div",T,[Object(n["f"])("fieldset",null,[Object(n["f"])("div",k,[Object(n["n"])(Object(n["f"])("input",{class:"form-check-input",type:"checkbox",value:"",id:"view360","onUpdate:modelValue":t[5]||(t[5]=function(e){return a.view360=e})},null,512),[[n["m"],a.view360]]),I])])])])])])])])])],64)}var R,S,G,B,F,V,N,L,_=o("2909"),D=o("53ca"),H=(o("159b"),o("caad"),o("2532"),o("b0c0"),o("5a89")),Y=o("8710"),X=o("4721"),U={props:["url"],data:function(){return{hideAlwaysObject:["Object036","Object070","Object072","Object079"],mainObject:["Object013"],load3dModel:!1,debug:!0,showPanel:!1,availableAdd:!0,mirrored:!1,view360:!0,objectGap:20,config:{Object019:{price:1e3,areasMapToAdd:[0,0,1,1]},Object045:{price:1e3,areasMapToAdd:[0,1,0,1]},Object042:{price:1e3,orientation:0,areasMapToAdd:[0,1,0,1]},Object013:{price:1e3,areasMapToAdd:[0,1,0,1]},Object056:{price:1e3,areasMapToAdd:[1,1,1,1]},Object062:{price:1e3,areasMapToAdd:[1,0,0,0]}}}},mounted:function(){var e,t,o=[],n=this,r=new Y["a"];e=document.getElementById("c");var a=document.getElementById("content"),i=document.getElementById("room");F=new H["P"],B=new H["I"](75,1,1,25e3),B.position.y=900,B.position.z=2100,B.position.x=-12,L=new X["a"](B,i);var c=new H["Y"];R=new H["Y"],G=new H["N"];var l=new H["l"](16777215,.9);l.position.set(1,1,1),F.add(l);var s=new H["r"](3e3,25);F.add(s);var d=document.createElement("div");function f(e){c.x=(e.clientX-S.left)/S.width*2-1,c.y=-(e.clientY-S.top)/S.height*2+1}function b(){var o=e.clientWidth,n=e.clientHeight;e.width===o&&e.height===n||t.setSize(o,n,!1)}function p(){u(),requestAnimationFrame(p)}function u(){b(),t.setClearColor(16777215),t.setScissorTest(!1),t.clear(),t.setClearColor(14737632),t.setScissorTest(!0),o.forEach((function(e){var o=e.userData.element,n=o.getBoundingClientRect();if(!(n.bottom<0||n.top>t.domElement.clientHeight||n.right<0||n.left>t.domElement.clientWidth)){var r=n.right-n.left,a=n.bottom-n.top,i=n.left,c=t.domElement.clientHeight-n.bottom;t.setViewport(i,c,r,a),t.setScissor(i,c,r,a);var l=e.userData.camera;t.render(e,l)}}));var e=i.getBoundingClientRect();if(S=i.getBoundingClientRect(),!(e.bottom<0||e.top>t.domElement.clientHeight||e.right<0||e.left>t.domElement.clientWidth)){if(c){G.setFromCamera(c,B);var n=G.intersectObjects(F.children,!0),r=document.querySelector("html");n.length>0?r.style.cursor="pointer":r.style.cursor="default"}var a=e.right-e.left,l=e.bottom-e.top,s=e.left,d=t.domElement.clientHeight-e.bottom;t.setViewport(s,d,a,l),t.setScissor(s,d,a,l),t.render(F,B)}}d.classList="row mt-3",r.load("/3d/"+this.url,(function(e){var t=e.children;t.forEach((function(e,t){var r=e.clone();if(!n.hideAlwaysObject.includes(r.name)){if(n.mainObject.includes(r.name)){var i=r.clone(),c=n.config[i.name]["areasMapToAdd"];i.userInfo={areasMapToAdd:c},i.position.x=0,i.scale.set(.3,.3,.3);var l=new H["Z"],s=(new H["e"]).setFromObject(i);s.getSize(l),i.position.y=l.y/2,i.position.z=l.z/2;var f=new H["s"];f.add(i),F.add(f)}var b=new H["P"];r.position.set(0,0,0),b.add(r);(new H["e"]).setFromObject(r);var p=document.createElement("div");p.className="info";var u=document.createElement("button");u.className="add btn btn-success w-100",u.innerText="Добавить",p.appendChild(u),u.addEventListener("click",(function(){return n.addObjectRoom(r)}));var h=document.createElement("div");h.className="list-item col-xxl-2 col-lg-3 col-md-3 col-sm-6 col-6",h.classList.add(r.name),d.appendChild(h);var m=document.createElement("div");h.appendChild(m);var v=document.createElement("div");v.appendChild(p),h.appendChild(v),b.userData.element=m,a.appendChild(d);var j=new H["I"](50,1,1,25e3);j.position.y=1e3,j.position.z=3e3,b.userData.camera=j;var O=new X["a"](b.userData.camera,b.userData.element);O.enablePan=!0,O.enableZoom=!0,b.userData.controls=O;var w=new H["l"](16777215,.9);w.position.set(1,1,1),b.add(w),o.push(b)}})),p(),n.load3dModel=!0})),t=new H["cb"]({canvas:e,antialias:!0}),t.setClearColor(16777215,1),t.setPixelRatio(window.devicePixelRatio),i.addEventListener("mousemove",f,!1),i.addEventListener("dblclick",this.activateObject,!1)},watch:{showPanel:function(e,t){e||(F.remove(N),this.mirrored=!1)},view360:function(e,t){L.enabled=!!e}},methods:{addObjectRoom:function(e){V={},this.showPanel=!1;var t,o;o=e.clone(),F.children.forEach((function(e,o){"Group"==e.type&&(o,t=e)})),this.availableAreasVoxel(t,o)},selectPlaceForObj:function(e){var t=e.currentTarget.group,o=e.currentTarget.addObject;R.x=(e.clientX-S.left)/S.width*2-1,R.y=-(e.clientY-S.top)/S.height*2+1,G.setFromCamera(R,B);var n=G.intersectObjects(F.children,!0);if("object"===Object(D["a"])(n[0])&&"object"===Object(D["a"])(n[0].object)&&"Mesh"===n[0].object.type&&"interBox"===n[0].object.name){for(var r=F.children.length-1;r>=0;r--)"ArrowHelper"===F["children"][r]["type"]&&F.remove(F["children"][r]);for(var a=n[0].object,i=t.children.length-1;i>=0;i--)"interBox"!==t["children"][i]["name"]&&"interBox"!==t["children"][i]["type"]||t.remove(t["children"][i]);var c=o.clone(),l=Object(_["a"])(this.config[c.name]["areasMapToAdd"]);console.log(Object({NODE_ENV:"production",BASE_URL:"/3d/"})),c.userInfo={areasMapToAdd:l},c.position.set(a.position.x,a.position.y,a.position.z),t.add(c)}},shiftArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";if("left"===t&&e.push(e.shift()),"right"===t&&e.unshift(e.pop()),"mirror"===t){var o=[e[0],e[2]];e[0]=o[1],e[2]=o[0]}return e},activateObject:function(e){V={},this.showPanel=!1,F.remove(N),R.x=(e.clientX-S.left)/S.width*2-1,R.y=-(e.clientY-S.top)/S.height*2+1,G.setFromCamera(R,B);var t=G.intersectObjects(F.children,!0);if("object"===Object(D["a"])(t[0])&&"object"===Object(D["a"])(t[0].object)&&"Mesh"===t[0].object.type){var o=t[0].object.parent;"Mesh"===o.type&&(V=this.getRootObj(o),N=new H["g"](V,14431557),F.add(N),this.showPanel=!0)}},getRootObj:function(e){var t=e.parent;if("Group"===t.type)return e;this.getRootObj(t)},rotate90Right:function(e){V.rotateZ(-90*Math.PI/180),V.userInfo.areasMapToAdd=this.shiftArray(V.userInfo.areasMapToAdd),N.update()},rotate90Left:function(e){V.rotateZ(90*Math.PI/180),V.userInfo.areasMapToAdd=this.shiftArray(V.userInfo.areasMapToAdd,"left"),N.update()},deleteObj:function(e){var t=V.parent;t.remove(V),V={},this.showPanel=!1,F.remove(N),N.update()},updatePositionElemGroup:function(e){var t,o,n=this;o=e.clone();for(var r=e.children.length-1;r>=0;r--)e.remove(e.children[r]);o.children.forEach((function(e,o){(0===o||Math.abs(e.position.x)<=Math.abs(t.position.x))&&(t=e)})),o.remove(t),t.position.x=0,e.add(t);for(var a=o.children.length-1;a>=0;a--){var i=o.children[a],c=void 0,l=(new H["e"]).setFromObject(e),s=(new H["e"]).setFromObject(i);c=i.position.x>0?n.positionNewObjRoom(l,s):n.positionNewObjRoom(l,s,"left"),i.position.set(c.x,c.y,c.z),e.add(i)}},mirror:function(e){var t=V.scale;V.scale.set(-t.x,t.y,t.z),V.userInfo.areasMapToAdd=this.shiftArray(V.userInfo.areasMapToAdd,"mirror"),N.update()},availableAreasVoxel:function(e,t){var o=this;t.scale.set(.3,.3,.3);var n=(new H["e"]).setFromObject(t),r=new H["Z"];n.getSize(r),e.children.forEach((function(n,a){var i=n.userInfo.areasMapToAdd,c=(new H["e"]).setFromObject(n),l=new H["Z"];if(c.getSize(l),1===i[1]){var s=new H["Z"](1,0,0).normalize(),d=new H["Z"](n.position.x+l.x/2+o.objectGap,n.position.y/2,n.position.z/2),f=new H["N"](d,s),b=f.intersectObjects(F.children);if(o.debug){var p=new H["c"](s,d,1e3,16776960*a/100);F.add(p)}if(0===b.length){var u=l.x/2+r.x/2+o.objectGap+n.position.x,h=r.y/2,m=n.position.z+r.z/2-l.z/2,v=new H["Z"](u,h,m);o.addVoxel(v,r,e,t)}}if(1===i[3]){var j=new H["Z"](-1,0,0).normalize(),O=new H["Z"](n.position.x-l.x/2-o.objectGap,n.position.y/2,n.position.z/2),w=new H["N"](O,j),g=w.intersectObjects(F.children);if(o.debug){var y=new H["c"](j,O,1e3,16776960*a/100);F.add(y)}if(0===g.length){var x=n.position.x-l.x/2-r.x/2-o.objectGap,z=r.y/2,M=n.position.z+r.z/2-l.z/2,A=new H["Z"](x,z,M);o.addVoxel(A,r,e,t)}}if(1===i[0]){var E=new H["Z"](0,0,-1).normalize(),P=new H["Z"](n.position.x,n.position.y/2,n.position.z-l.z/2-o.objectGap),C=new H["N"](P,E),T=C.intersectObjects(F.children);if(o.debug){var k=new H["c"](E,P,1e3,16776960*a/100);F.add(k)}if(0===T.length){var I=n.position.x-l.x/2+r.x/2-o.objectGap,Z=r.y/2,R=n.position.z-l.z/2-r.z/2-o.objectGap,S=new H["Z"](I,Z,R);o.addVoxel(S,r,e,t)}}if(1===i[2]){var G=new H["Z"](0,0,1).normalize(),B=new H["Z"](n.position.x,n.position.y/2,n.position.z+l.z/2+o.objectGap),V=new H["N"](B,G),N=V.intersectObjects(F.children);if(o.debug){var L=new H["c"](G,B,1e3,16776960*a/100);F.add(L)}if(0===N.length){var _=n.position.x-l.x/2+r.x/2+o.objectGap,D=r.y/2,Y=n.position.z+l.z/2+r.z/2+o.objectGap,X=new H["Z"](_,D,Y);o.addVoxel(X,r,e,t)}}}))},addVoxel:function(e,t,o,n){var r=this,a=new H["f"](t.x,t.y,t.z),i=new H["C"]({color:16711680,opacity:.5,transparent:!0}),c=new H["B"](a,i);c.name="interBox",c.position.set(e.x,e.y,e.z),o.add(c);var l=function(e){r.selectPlaceForObj(e)};document.addEventListener("click",l),document.group=o,document.addObject=n}}},W=(o("12d9"),o("6b0d")),q=o.n(W);const J=q()(U,[["render",Z]]);var K=J,Q={components:{Model:K}};const $=q()(Q,[["render",a]]);var ee=$,te=(o("ab8b"),o("becf"),o("c27a")),oe=Object(n["b"])(ee);oe.use(te["a"]),oe.mount("#app")},e01d:function(e,t,o){}});
//# sourceMappingURL=app.83fb0e22.js.map